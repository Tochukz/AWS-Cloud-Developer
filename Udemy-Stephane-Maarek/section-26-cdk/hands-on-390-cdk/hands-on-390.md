# Lesson 390: CDK - Hands on

### Description

The example shows how to use AWS CDK to provision AWS resources.  
Here we configure an S3 bucket, a DynamoDB table, and a Lambda function that uses Amazon Rekognition to label images uploaded to the S3 bucket.  
The Lambda function is triggered by S3 events when new images are uploaded.

### Operation

**Before Deployment**

1. Ensure you have the CDK CLI installed

```bash
$ npm install -g aws-cdk
```

2. Ensure that AWS CDK has been bootstrapped in your AWS account in the region you want to deploy to. If not, run:

```bash
# This may be done only once per AWS account per region
$ cdk bootstrap
```

**Deployment**

1. (optional) You may synthesize the CloudFormation template to see what template will be generated:

```bash
$ cd cdk-app
$ cdk synth
```

Check the `cdk.out` directory for the generated CloudFormation template.

2. Do a diff to preview what will be deployed (recommended for updates):

```bash
$ cdk diff
```

3. Deploy the stack:

```bash
$ cdk deploy
```

**After Deployment**

**Testing**

1. Upload images to the S3 bucket created by the application.

```bash
$ aws s3 cp images/penguins.jpeg s3://images-bucket-12-07/
$ aws s3 cp images/kid_and_pigeons.jpeg s3://images-bucket-12-07/
$ aws s3 cp images/swans.jpeg s3://images-bucket-12-07/
```

2. Go to the DyanomoDB Console, check the table for the labels generated by the Lambda function.

**Debug Errors**

**Cleanup**  
Emtpty the S3 bucket

```bash
$ aws s3 rm s3://images-bucket-12-07/ --recursive
```

Delete the stack

```bash
$ cdk destroy
```
